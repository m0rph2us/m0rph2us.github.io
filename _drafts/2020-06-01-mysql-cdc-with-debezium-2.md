---
layout: post
excerpt_separator: <!--more-->
title: 'MySQL CDC With Debezium #2'
categories: mysql cdc debezium
---

# 디비지움으로 MySQL CDC 하기 #2
## 개요

이번 글에서는 작은 예제를 통해 디비지움을 어떻게 사용하는지 간략하게 알아보려고 한다.
<!--more-->

## 아키텍처

우리가 예제로 만들 작은 시스템의 아키텍처는 다음과 같다. 실제 프로덕션에서 사용하는 아키텍처도 이와 크게 다르지 않다. 기본 뼈대는 같고 단지 HA 구성을 위해 
Zookeeper, Kafka 가 더 추가되는 정도이다. 프로덕션 고려사항에 대해서는 3편에서 살펴보도록 할 것이다.

{:refdef: style="text-align: center;"}
![architecture](/assets/simple-debezium-usage-architecture.png)
{: refdef}

위의 아키텍처에서 각각은 다음과 같다.

* MySQL Master DB1
  * 디비지움이 데이터 변경을 캡처하길 원하는 원본 DB 이다.
* Debezium
  * 디비지움 커넥터이다. 원본 MySQL 데이터베이스에 리플리케이션 클라이언트로 붙어 데이터 변경을 캡처하고, 변경 메시지를 카프카에 프로듀싱하는 역할을 한다.
* Schema Registry
  * 스키마 레지스트리이다. 보통 JSON 같은 직렬화 규격을 사용하기도 하지만, JSON은 타입을 엄격하게 처리할 수 없는 성질이 있다. 따라서 AVRO 직렬화 규격을 
  사용하는데, 이때 공용 스키마 저장소 같은 역할을 하는 것이 스키마 레지스트리이다. 이 레지스트리에 스키마 정보를 저장해두고, 직렬화와 역직렬화를 수행할 때 
  이를 참고하여 사용할 수 있다.
  * 이 부분은 필요하다면 바로 앞단에 LB 구성을 추가하여 가용성을 높일 수 있다.  
* Zookeeper
  * 카프카 클러스터의 상태를 관리한다.
* Sample App
  * 카프카 토픽을 읽어 처리하는 애플리케이션이다. 이는 스트림 프로세싱 애플리케이션이 될 수도, 데이터를 말단에서 처리하는 싱크 애플리케이션이 될 수도 있다. 
  우리가 주로 코딩하는 부분은 이 부분이 된다.
* MySQL Master Db2
  * Sample App 에처 처리한 데이터가 최종적으로 저장되는 곳이다.

미리 예제를 만들어 놓았다. 예제는 단순히 Db1에서 일어나는 C(Create), U(Update), D(Delete)를 그대로 DB에 반영하는 아주 간단한 예제이다. 사실 단순히 
테이블 대 테이블로 데이터를 그대로 반영할 목적이라면 DB에서 제공하는 리플리케이션 기능을 최대한 활용하는 것이 좋다. CDC는 여러 여건상 그것이 도저히 안될 때만 
최후의 수단으로 사용하는 것이 좋다.

## 예제 맛보기

먼저 미리 만들어둔 예제 코드를 깃헙에서 내려받아 실행해보도록 하자.

## 마무리

간략한 예제를 통해 디비지움을 어떻게 사용하는지 살펴보았다. 하지만, 말 그대로 이해를 돕기 위한 간략한 예제일 뿐이다. 실제 프로덕션에서 사용하기 위해서는 
고려할 요소가 더 존재한다. 3편에서는 프로덕션에서의 고려사항을 설명하려고 한다.

## 참고

1. [샘플 클러스터 + 애플리케이션](https://github.com/m0rph2us/docker-debezium)